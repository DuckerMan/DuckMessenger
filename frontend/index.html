<!DOCTYPE html> 


<html> 
<head> 






  <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script language="javascript" src="js/lz-string.js"></script>
   <script language="javascript" src="js/async.js"></script>
<!--  <script src="/js/recorder.js"></script> -->
<script type="text/javascript" src="https://cdn.rawgit.com/ricmoo/aes-js/e27b99df/index.js"></script>
 <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">

  <!-- Compiled and minified JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>

  <script src="js/comServer.js"></script>
  <script src="js/client.js"></script>
<!--   <script src="assets/js/main.js"></script> -->

  <script src="/socket.io/socket.io.js"></script>
  

  
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

        <meta name="viewport" content="initial-scale=1, maximum-scale=1">
<title>Duck Messenger</title> 
 <meta name="description" content="DuckMessenger is a free and opensource Messenger">


<style>


::-webkit-scrollbar {
  width: 5px;
  height: 5px;
}
::-webkit-scrollbar-button {
  width: 0px;
  height: 0px;
}
::-webkit-scrollbar-thumb {
  background: #f6f5f5;
  border: 0px none #ffffff;
  border-radius: 50px;
}
::-webkit-scrollbar-thumb:hover {
  background: #ffffff;
}
::-webkit-scrollbar-thumb:active {
  background: #ffffff;
}
::-webkit-scrollbar-track {
  background: #c3bebe;
  border: 0px none #ffffff;
  border-radius: 50px;
}
::-webkit-scrollbar-track:hover {
  background: #666666;
}
::-webkit-scrollbar-track:active {
  background: #847d7d;
}
::-webkit-scrollbar-corner {
  background: transparent;
}

html{overflow: hidden;background: #5682a3;font-family: Roboto;}
@import url('https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300|Open+Sans:100,200,300,400,500,600,700|Poiret+One|Roboto:100,200,300, 300i,400, 400i,500, 500i,700&subset=cyrillic');

 @font-face {
    font-family: ProximaNovaCondesedSemibold; /* Имя шрифта */
    src: url("fonts/Proxima Nova Condensed Semibold.otf"); /* Путь к файлу со шрифтом */
   }
    @font-face {
    font-family: ProximaNovaRegular; /* Имя шрифта */
    src: url("fonts/Proxima Nova Regular.otf"); /* Путь к файлу со шрифтом */
   }
    @font-face {
    font-family: ProximaNovaSemibold; /* Имя шрифта */
    src: url("fonts/Proxima Nova Semibold.otf"); /* Путь к файлу со шрифтом */
   }

@keyframes loadingFirst{
  from{
    top: 37%;
  }
  45%{
    height: 100px;
  }
  50%{
    top: 50%;
  }
  100%{
    height: 128px;
  }
  to{
     top: 37%;
  }
}
#firstLoadingAnimation{
  width: 128px;
  height:128px;
  border-radius: 50%;
  background-color:#3857b2;
  animation: loadingFirst 1.5s infinite;
  position: absolute;
  margin:-64px 0 0 -64px;
  display: none;
  left:50%;
top:50%;

}
.popUpDialog{
  width: 480px;
height: 290px;
position: absolute;
background:white;
border-radius: 2px;
    z-index: 10;

position:absolute;
left:50%;
top:50%;
margin:-145px 0 0 -240px;
overflow: hidden;
display: none;
}

.simpleBlock{
    width: 480px;
height: 290px;
position: absolute;
background:white;
border-radius: 2px;
    z-index: 10;

position:absolute;
left:50%;
top:50%;
margin:-145px 0 0 -240px;
overflow: hidden;
display: none;
}

.simpleBlock #title{
  font-family: Roboto;
    font-size: 17px;
    color: #212121;
    position: relative;
    /* float: left; */
    /* top: 19px; */
    /* left: 45px; */
    text-align: center;
    font-weight: 400;
    top: -5px;


}
.subText{
  font-family: Roboto;
  color: #7d7d7d;
  font-size: 12px;
  font-weight: 300;
  display: none;
}
#blockAuth{
  height: 220px;
  margin:-110px 0 0 -240px;
}
#blockAuth #nextStepButtonAuth{

}
.nextStepButton{
   background: #3F51B5;
    position: relative;
    top: 16px;
}
.nextStepButton:hover{
      background-color: #5164ce;
}
#blockAuth #subText{
position: relative;
    top: 13px;

}
#blockAuth .progressAuth{
  position: relative;
    top: 9px;
    width: 325px;
    display: none;
}

.popUpDialogInfo{
   width: 400px;
    height: 140px;
    position: absolute;
    background: white;
    border-radius: 1px;
    z-index: 11;
    position: absolute;
    left: 50%;
    top: 50%;
    margin: -70px 0 0 -200px;
    overflow: hidden;
    display: none;
}

.popUpDialogInfo #title{
font-family: Roboto;
    font-size: 17px;
    color: #212121;
    position: absolute;
    float: left;
    top: 6px;
    left: 39px;
    font-weight: bold;


}
.popUpDialogInfo #text{
  font-family: Roboto;
    font-size: 17px;
    color: #484747;
    position: relative;
    text-align: center;
    top: 21px;
    font-weight: 400;
  


}
.popUpDialogInfo #cancelButton{
position: absolute;
bottom: 2px;
padding: 9px 7px;
right: 50px;
    line-height: 19px;
}
.popUpDialogInfo #agreeButton{
  position: absolute;
bottom: 2px;
right: 9px;
padding: 9px 7px;
    line-height: 19px;
}
#mask{
  z-index: 8;
  width: 115%;
  height: 115%;
  left: -10%;
  top: -10%;
  position: fixed;

  background: rgba(0, 0, 0, 0.3);
  display: none;
}


div #leftPanelMessages{
  width: 265px;
  height: 100%;
  position: fixed;
  z-index: 11;
  background: white;
  overflow: auto;
}
div #leftPanelMessages .dialog{
  width: 100%;
  
  height: 56px;
  background-color: white;
      top: 48px;
    margin-top: 0px;


}
div #leftPanelMessages .dialog:first-child {
    /* top: 28px; */
    margin-top: -3px;
}


div#topPanelWithMenu {
  position: absolute;
    background: white;
    width: 100%;
    height: 45px;
    top: 0px;

}


.selectedDialog{
background-color: #1976D2 !important;
}

.selectedName{
color: #ffffff !important;
}

.selectedText{
color: #e8e8e8 !important;
}

div #leftPanelMessages .dialog #templateName{
    position: absolute;
    width: 159px;
    height: 15px;
    border-radius: 10px;
    top: -5px;
    left: 64px;
    background: #E3F2FD;
}





div #leftPanelMessages .dialog #templateImage{
  position: absolute;
    width: 48px;
    height: 48px;
    border-radius: 100px;
    top: 3px;
    left: 5px;
    background: #caced2;
}
div #leftPanelMessages .dialog #templateMessage{
    position: absolute;
    width: 159px;
    height: 13px;
    border-radius: 10px;
    top: 19px;
    left: 64px;
    background: #d4d7da;

}

div #leftPanelMessages .dialog #userName{
       position: relative;
    font-size: 15px;
    top: -8px;
    left: 62px;
    color: #212121;
    font-weight: 500;
        width: 182px;
}

div #leftPanelMessages .dialog #profilePhoto{
position: relative;
    width: 48px;
    height: 48px;
    top: -81px;
    left: 6px;
    border-radius: 100px;
}
.messagesBlock {
    overflow: auto;
    height: 93%;
}
.statusSendMessage{
      font-size: 16px;
    position: relative;
    bottom: -9px;
    right: -4px;
    float: right;
    color: #1bff1b;
}


.mobileBackButton {
    color: #757575;
    position: relative;
    float: left;
     font-size: 32px;
     display: none;

}
.backDialogs{
  margin-top: 7px;
    margin-left: 12px;
    cursor: pointer;
    width: 32px;
    height: 32px;
}
    

.rightBlock{
  background: #ececec;
  position: absolute;
  height: 100%;
  left: 265px;
  z-index: 1;
}

div #leftPanelMessages .dialog #textMessage{
      position: relative;
    font-size: 14px;
    top: -23px;
    left: 63px;
    color: #797979;
        width: 182px;
        height: 19px;
}


div #userInfoTopPanel {
 width: 100%;
    height: 45px;
    background: white;
    z-index: 15;
    position: fixed;
    top: 0px
}

#topPanelName{

      font-size: 17px;
    position: relative;
    float: left;
    display: inline;
    margin-top: 2px;
    margin-left: 3px;
    color: #272727;
    font-weight: 500
}

.topPanelLastonline{
  display: inline-block;
    position: absolute;
    float: left;
    left: 54px;
    top: 10px;
    font-size: 13px;
}
#profilePhotoTopPanel{
  width: 45px;
    height: 45px;
    position: relative;
    border-radius: 50%;
    float: left;
        margin-left: 6px;
}
p.topPanelLastonline.online{
    color: #388E3C;
}
p.topPanelLastonline.offline{
  color: #969696;
}

#noDialogsText{
  color: #565656;
    font-size: 18px;
    position: absolute;
    left: 10%;
    display: none;
    top: 39%;
}

.messageSendBlock{
position: absolute;
    bottom: 0px;
    width: 90%;
  
    height: 47px;
    border-radius: 4px;
    color: #212121;
    padding-left: 35px;
    padding-top: 10px;
    padding-right: 40px;
    overflow: auto;
    background: white;
    border-bottom: 1px solid #dedede;
}

.sendMsgButton{
      position: absolute;
    right: 3px;
    font-size: 35px;
    color: #757575;
    cursor: pointer;
    transition: 300ms;
    top: 6px;

}

.sendMsgButton:hover{
color: #5a5a5a;
}

.messagesSendSection{
position: absolute;
    bottom: 0px;
    width: 100%;
  background: white;
    height: 47px;
}

.sendAttachmentButton{
      transform: rotate(90deg);
    position: absolute;
    font-size: 32px;
    height: 36px;
    width: 36px;
    color: #757575;
    cursor: pointer;
    left: -3px;
    top: 8px;
    z-index: 23;

}


.dialogsImageSend{
          max-width: 305px;
    max-height: 450px;
    cursor: pointer;
}
/* Dialogs */





.messagesList{
  list-style: none;
  margin: 0;
  padding: 0;
      position: relative;
    top: 54px;
}

.messagesList li{
display: inline-block;
    clear: both;
    padding-top: 5px;
    padding-bottom: 5px;
    padding-left: 7px;
    padding-right: 7px;
    max-width: 320px;
  
    border-radius: 6px;
    margin-bottom: 6px;
    font-family: Roboto;
}

.messageToMe{
  background: #eee;
  float: left;
  background: #7cb8ef;
    color: white;
    border-bottom-left-radius: 5px;
    max-width: 320px;
    word-wrap: break-word;

}

.messageFromMe{
  float: right;
  background: #0084ff;
  color: #fff;
  max-width: 320px;
    word-wrap: break-word;
      border-bottom-right-radius: 5px;

      margin-right: 6px;
}

.messageToMe + .messageFromMe{
  border-bottom-right-radius: 5px;
}

.messageFromMe + .messageFromMe{
  border-bottom-right-radius: 5px;
}





/* end */
@media screen and (max-width: 480px){

  div #leftPanelMessages{
    width: 100%;
  }


  #blockAuth .progressAuth{
    width: 291px;
  }
  .topPanelLastonline {
    display: inline-block;
    position: absolute;
    float: left;
    left: 98px;
    top: 10px;
    font-size: 13px;
}
#noDialogsText{
  left: 15%;
}
  .mobileBackButton{
    display: block;
  }
   #blockAuth{
    width: 100%;
    margin: -110px 0 0 -0px;
    left: 0px;
  }
}


</style>
</head> 
<body> 






<ul id="slide-out" class="side-nav">
    <li><div class="user-view">
      <div class="background">
        <img src="images/background.jpg">
      </div>
      <a href="#!info"><img class="circle" id="infoPanelImage" src="images/defaultprofileimage.jpg"></a>
      <a href="#!info"><span class="white-text name" id="infoPanelName" class="truncate">Орехус</span></a>
      <a href="#!info"><span class="white-text email" id="infoPanelLogin" class="truncate">орехус@gmail.com</span></a>
    </div></li>
    
    <li class="waves-effect" style="width: 100%;"><a style="cursor: pointer;"><i class="material-icons">settings</i><span style="margin-left: -17px;">Настройки</span></a></li>
    <li class="waves-effect" style="width: 100%;"><a style="cursor: pointer;"><i class="material-icons">contacts</i><span style="margin-left: -17px;">Контакты</span></a></li>
  
  </ul>
  






<div id="mask"></div>
<div id="firstLoadingAnimation"></div>
<div class="popUpDialogInfo" id="infoPopup">
  
  <p id="title">Are you love Duck?</p>
  <br>
  <p id="text">I love Ducks, do you?</p>

  <a class="waves-effect waves-red btn-flat" id="cancelButton" onclick="">CANCEL</a>
   <a class="waves-effect waves-green btn-flat" id="agreeButton">OK</a>
</div>


<div class="simpleBlock" style="display: none;z-index: 4;" id="blockAuth">
  


<center>

<section id="firstAuthSection">
  
<p id="title">Пожалуйста, введите ваш логин</p>
<div class="input-field col" style="    width: 275px;top: 16px;">
          <input id="myLoginInput" type="text" class="validate">
          <label for="myLoginInput" id="myLoginInputLabel">Логин</label>
        </div>


<a class="waves-effect waves-light btn nextStepButton" id="nextStepButtonAuth" onclick="client.authAccount($('#myLoginInput').val());">Далее</a>
<p class="subText" id="subText">Проверка..</p>
<div class="progress progressAuth" id="progressAuth">
      <div class="indeterminate"></div>
  </div>

</section>



<section id="needAuthcodeSection" style="display: none;">
  
<p id="title">Пожалуйста, введите код авторизации</p>
<div class="input-field col" style="    width: 275px;top: 16px;">
          <input id="myAuthcodeInput" type="text" class="validate">
          <label for="myAuthcodeInput" id="myAuthcodeInputLabel">Код авторизации</label>
        </div>


<a class="waves-effect waves-light btn nextStepButton" id="nextStepButtonAuthcode" onclick="client.enterCode($('#myLoginInput').val(), $('#myAuthcodeInput').val());">Далее</a>
<p class="subText" id="subText">Проверка..</p>
<div class="progress progressAuth" id="progressAuthCode">
      <div class="indeterminate"></div>
  </div>
  
</section>


<section id="needRegcodeSection" style="display: none;">
  
<p id="title">Пожалуйста, введите код регистрации</p>
<div class="input-field col" style="    width: 275px;top: 16px;">
          <input id="myRegcodeInput" type="text" class="validate">
          <label for="myRegcodeInput">Код регистрации</label>
        </div>


<a class="waves-effect waves-light btn nextStepButton" id="nextStepButtonRegcode" onclick="client.validateAccount($('#myLoginRegInput').val(), $('#myRegcodeInput').val());">Далее</a>
<p class="subText" id="subText">Проверка..</p>
<div class="progress progressAuth" id="progressAuthCode">
      <div class="indeterminate"></div>
  </div>
  
</section>


<section id="registrationS" style="display: none;">
  
<p id="title">Пожалуйста, введите ваши данные</p>



<div class="input-field col inline" style="   width: 225px;top: -21px;float: left;">
          <i class="material-icons prefix" style="    color: #c73636;">account_circle</i>
          <input id="myNameInput" type="text" class="validate">
          <label for="myNameInput">Имя</label>
        </div>

<div class="input-field col inline" style="    width: 225px;top: -21px;float: left;">
          <i class="material-icons prefix" style="    color: #c73636;">account_circle</i>
          <input id="mySurnameInput" type="text" class="validate">
          <label for="mySurnameInput">Фамилия</label>
        </div>


        <div class="input-field col inline" style="   width: 225px;top: -21px;float: left;">
          <i class="material-icons prefix" style="    color: #c73636;">email</i>
          <input id="myEmailInput" type="text" class="validate">
          <label for="myEmailInput">Почта</label>
        </div>

<div class="input-field col inline" style="    width: 225px;top: -21px;float: left;">
          <i class="material-icons prefix" style="    color: #c73636;">account_box</i>
          <input id="myLoginRegInput" type="text" class="validate">
          <label for="myLoginRegInput">Логин</label>
        </div>

<a class="waves-effect waves-light btn nextStepButton" id="nextStepButtonRegister" onclick="client.registration($('#myEmailInput').val(), $('#myLoginRegInput').val(), $('#myNameInput').val(), $('#mySurnameInput').val());" style="top: -31px;">Далее</a>
<p class="subText" id="subText">Проверка..</p>
<div class="progress progressAuth" id="progressAuthCode" style="top: -29px;">
      <div class="indeterminate"></div>
  </div>
  
</section>

</center>

</div>

 <div class="row" style="display: none;background: #e7ebf0;">
 
<div id="leftPanelMessages" class="z-depth-1">
  <div id="topPanelWithMenu">
    <a href="#" data-activates="slide-out" class="button-collapse"><i class="material-icons" style="    font-size: 46px;
    color: #757575;
    top: -1px;
    position: relative;
}">menu</i></a>

  </div>


<div class="preloader-wrapper active" id="prealoderDialogs" style="
    width: 48px;
    height: 48px;
    position: absolute;
    left: 42%;
    top: 41%;
">
    <div class="spinner-layer spinner-red-only">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div><div class="gap-patch">
        <div class="circle"></div>
      </div><div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>
  </div>



<!-- <div class="dialog" id="messageGolyb">
  <p id="userName">Тимур Ганиуллин</p>
   <p id="textMessage" style="
">го в майн</p>
  <img src="https://pp.userapi.com/c840638/v840638859/f4b7/IPoJGS6Zfyo.jpg" id="profilePhoto"></img>
</div> -->

</div>





<div class="rightBlock">
  
<div class="preloader-wrapper big active " id="spinnerMessages" style="
    width: 48px;
    height: 48px;
    position: absolute;
    z-index: 100;
    left: 42%;
    top: 43%;
    display: none;
    -webkit-animation: container-rotate 1010ms linear infinite;
    animation: container-rotate 1010ms linear infinite;
">
    <div class="spinner-layer spinner-red-only">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div><div class="gap-patch">
        <div class="circle"></div>
      </div><div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>
  </div>



<!-- <div class="messagesBlock" id="blockTester">
  
  <div id="userInfoTopPanel" class="z-depth-2">
    <img src="" id="profilePhotoTopPanel">
  <p id="topPanelName">Тимур Ганиуллин</p>
  <p id="topPanelLastonline">Онлайн</p>
  </div>


</div> -->

</div>

</div>


<form style="opacity: 0;position: absolute;left: -1000%;" id="formInputFile">
  
  <input type="file" name="file" class="uploadFileInput" multiple style="
">
  <input type="submit" value="" class="buttonLoadFile" style="
">

</form>


<script>


$('.uploadFileInput').on('change', function(e){
 

    var files = this.files;

    client.onLoadAttachment(files);
});



 $('.button-collapse').sideNav({
      menuWidth: 320, // Default is 300
      edge: 'left', // Choose the horizontal origin
      closeOnClick: true, // Closes side-nav on <a> clicks, useful for Angular/Meteor
      draggable: true, // Choose whether you can drag to open on touch screens,
      onOpen: function(el) { /* Do Stuff */ }, // A function to be called when sideNav is opened
      onClose: function(el) { /* Do Stuff  */ }, // A function to be called when sideNav is closed
    }
  );
var tmpSocket = new ServerCommunitation(io());
tmpSocket.socketCopy.on('connect', function(){




 
})
var client = new Client(tmpSocket);


tmpSocket = undefined;







 if(getCookie('lastLogin') != undefined && getCookie('lastCrt')!=undefined){
  client.authByCrt(getCookie('lastLogin'), getCookie('lastCrt'));
}


client.onResize();



$(window).resize(function(e){
client.onResize();

});



$(window).on('load', function(){
  if(getCookie('firstLogin')==undefined){



$('#firstLoadingAnimation').show();
}

});
$(document).ready(function(){


  if(getCookie('firstLogin')==undefined){
    setCookie('firstLogin', true);

    $('#firstLoadingAnimation').css('animation', 'null');
  $('#firstLoadingAnimation').animate({top:'-1000px', left:'-1000px', height:'5500px', width:'5500px'}, 250, function(){
    $('#firstLoadingAnimation').fadeOut(250);

    setTimeout(function(){
      $('#blockAuth').show();
    }, 300);
  });

  }

  else{

    $('#blockAuth').show();
  }
 
  
})



$(window).on('keyup', function(e){
if(e.keyCode==13){
  if($('.selectedDialog').attr('id')==undefined) return false;


  var to = $('.selectedDialog').attr('id').replace('message', '');


  client.sendMessage($('#block'+to+' .messageSendBlock').text(), to);
  setTimeout(function(){
    $('#block'+to+' .messageSendBlock').html('');
  }, 250);
  
} 
});






function modulesWindow(){


  this.closeWindows = function(){
    $('#mask').hide();
    $('.popUpDialog').hide();
    $('.popUpDialogInfo').hide();
  };
  this.openWindow = function(win, data){
    // data = {onAgree:function(){}, onCancel:function(){}}
    $('#mask').show();
    $('#'+win).show();

  };

  this.closeMobileWindow=function(windowClose, windowOpen){

    windowOpen.show();
    windowOpen.css('left', '0px');
    console.log(windowClose);
    console.log(windowOpen);
    windowClose.animate({left:'-105%'}, 200);
  
    windowClose.fadeOut(50);

  };



   this.openWindowText = function(win, data){
     // data = {onAgree:function(){}, onCancel:function(){}, text:'Duck', title:'Quack'}
    $('#mask').show();
    $('#'+win).show();
    $('#'+win+' #title').text(data['title']);
    $('#'+win+' #text').text(data['text']);
    $('#'+win+' #agreeButton').attr('onclick', data['onAgree']);
    $('#'+win+' #cancelButton').attr('onclick', data['onCancel']);


  };
}


/*if(getCookie('lastLogin') != undefined && getCookie('lastCrt')!=undefined){
  client.authByCrt(getCookie('lastLogin'), getCookie('lastCrt'));
}*/
function getCookie(name) {
  var matches = document.cookie.match(new RegExp(
    "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
  ));
  return matches ? decodeURIComponent(matches[1]) : undefined;
}



function setCookie(name, value, options) {
  options = options || {};

  var expires = options.expires;

  if (typeof expires == "number" && expires) {
    var d = new Date();
    d.setTime(d.getTime() + expires * 1000);
    expires = options.expires = d;
  }
  if (expires && expires.toUTCString) {
    options.expires = expires.toUTCString();
  }

  value = encodeURIComponent(value);

  var updatedCookie = name + "=" + value;

  for (var propName in options) {
    updatedCookie += "; " + propName;
    var propValue = options[propName];
    if (propValue !== true) {
      updatedCookie += "=" + propValue;
    }
  }

  document.cookie = updatedCookie;
}

function strstr( haystack, needle, bool ) { // Find first occurrence of a string
  // 
  // +   original by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)

  var pos = 0;

  pos = haystack.indexOf( needle );
  if( pos == -1 ){
    return false;
  } else{
    if( bool ){
      return haystack.substr( 0, pos );
    } else{
      return haystack.slice( pos );
    }
  }
}

function AudioOnNewMessage() {
  var audio = new Audio(); 
  audio.src = 'audio/newMessage.mp3'; 
  audio.autoplay = true; 
}



   

     


function escapeHtml(text) {
  var map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };

  return text.replace(/[&<>"']/g, function(m) { return map[m]; });
}
function replaceURLWithHTMLLinks(text) {
    var exp = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
    return text.replace(exp,"<a class='MessageLinkHref' onclick='IsHavePreview($1)'>$1</a>"); 
}

function addslashes(str) {
  if(typeof str == 'number') return str;
    str=str.replace(/\\/g,'\\\\');
    str=str.replace(/\'/g,'\\\'');
    str=str.replace(/\"/g,'\\"');
    str=str.replace(/\0/g,'\\0');
    return str;
}


/*
$('.messageSendBlock').on('focus', function(){
console.log('Focus on msg block');
$('.messageSendBlock').height('75px');
$('.messageSendBlock').css('border-bottom', '2px solid #dedede;');
});
$('.messageSendBlock').on('blur', function(){
console.log('blur on msg block');
$('.messageSendBlock').height('47px');
$('.messageSendBlock').css('border-bottom', '1px solid #dedede;');
});*/

$(document).on('input', '#myAuthcodeInput', function () {
  console.log('INPUT');
  var $item = $(this),
    value = $item.val();

    if(value.length == 4){
     client.enterCode($('#myLoginInput').val(), value);
    }
    if(value.length > 4){
      $item.val(value.substr(0, 4));
    }

});

$(document).on('input', '#myRegcodeInput', function () {
  var $item = $(this),
    value = $item.val();
console.log('INPUT');
    if(value.length == 4){
     client.validateAccount($('#myLoginRegInput').val(), value);
    }
    if(value.length > 4){
      $item.val(value.substr(0, 4));
    }

});

function isEmpty(obj) {

    // null and undefined are "empty"
    if (obj == null) return true;

    // Assume if it has a length property with a non-zero value
    // that that property is correct.
    if (obj.length > 0)    return false;
    if (obj.length === 0)  return true;

    // If it isn't an object at this point
    // it is empty, but it can't be anything *but* empty
    // Is it empty?  Depends on your application.
    if (typeof obj !== "object") return true;

    // Otherwise, does it have any properties of its own?
    // Note that this doesn't handle
    // toString and valueOf enumeration bugs in IE < 9
    for (var key in obj) {
        if (hasOwnProperty.call(obj, key)) return false;
    }

    return true;
}

setInterval(function(){
  if(!document.hidden) $('title').html('Duck Messenger');
  
}, 777);






</script>
</body> 
</html>